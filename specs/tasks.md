# SheetDB Task List (from BASIC.md)

このタスクリストは BASIC.md の内容を整理したもの。BASIC.md の更新に合わせて
随時見直す。

## 1. 概要・構成 (BASIC.md 1-2)

- [ ] メインサイト（sheetdb.app）とデモ/プレイグラウンド（demo.sheetdb.app）の役割分担を維持する
- [ ] Cloudflare Workers 側の構成を整理し、UI/デモ/API の責務を明確化する

## 2. Google Sheets ルール (BASIC.md 3)

- [ ] 1行目=ヘッダー、2行目=メタデータ、3行目以降=データ行の構造を遵守する
- [ ] 2行目JSONメタデータのパース/バリデーション/デフォルト適用を実装する
- [ ] 2行目のJSON文字列の保存形式とエスケープ規則を統一する

## 3. 行レベルACLと認証 (BASIC.md 3, 5.3)

- [ ] ACLカラム（_public/_role/_user）による読み書き制御を実装する
- [ ] ACLの評価順序（public → role → user）を一貫させる
- [ ] マスターキーによるACLバイパスの扱いを整備する
- [ ] _Users を起点とした認証フローを維持する

## 4. セットアップウィザード (BASIC.md 4)

- [ ] 初期設定ウィザードでスプレッドシートとストレージを紐付ける
- [ ] 管理者アカウントとマスターキーを初期化する
- [ ] _Users / _Roles / _Files を未存在時に自動生成する

## 5. データモデル: Google Sheets (BASIC.md 5)

- [ ] _Users の必須フィールドとハッシュ化パスワード運用を実装する
- [ ] _Roles / _Files の必須フィールドと既定値を実装する
- [ ] 新規シート作成時の既定カラムを自動生成する
- [ ] シート命名制約（英数字+アンダースコア、_プレフィックス禁止）を適用する

## 6. 型とformulaの扱い (BASIC.md 5.3)

- [ ] サポート型（string/number/boolean/date/array/object/formula）を整備する
- [ ] formula型はGoogle Sheetsの計算式として保存し、読み取りは計算結果のみ返す
- [ ] 無効な式はバリデーションエラーとして扱う

## 7. Cloudflare側データモデル (BASIC.md 6)

- [ ] D1 Configs テーブルの項目と既定値を整備する
- [ ] D1 Sessions テーブルの項目と有効期限を整備する
- [ ] 設定画面で変更可能な項目の反映を実装する

## 8. KVキャッシュ (BASIC.md 6.2)

- [ ] KVキャッシュTTLを60分（3600秒）で運用する
- [ ] キャッシュミス時の再生成フローを整備する

## 9. API処理フロー (BASIC.md 7)

- [ ] Readフロー（認証→KV→シート→ACL→ページング）を実装する
- [ ] Writeフロー（認証→ACL→シート更新→キャッシュ再生成）を実装する

## 10. セキュリティ運用 (BASIC.md 5.1)

- [ ] パスワードはハッシュ化した文字列のみ保存し、ログ/レスポンスに含めない
