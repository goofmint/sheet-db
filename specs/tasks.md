# SheetDB Task List (from BASIC.md)

このタスクリストは BASIC.md の仕様を実現できるシステムに落とし込むための
開発フェーズ別のタスク一覧。各フェーズは「UIで確認できる」「デプロイ可能」
な状態を維持しながら進め、毎フェーズでデプロイを実施する。

## 運用ルール

- 優先度はフェーズ順 → フェーズ内の上から順で選定する
- ステータスはチェックボックスで管理する（未完了: `[ ]`, 完了: `[x]`）
- 各フェーズの完了条件は「動作確認済み」「デプロイ可能」かつ
  「デプロイ実施済み」であること

## Phase 1: 環境構築 (BASIC.md 2)

- [ ] Cloudflare Workers + Hono の開発環境を用意する
- [ ] sheetdb.app（React Router）と demo.sheetdb.app をローカルで同時起動できるようにする
- [ ] D1/KV のローカル検証手段を用意する（本番と同等の挙動確認）
- [ ] フェーズ1の動作確認を実施する
- [ ] フェーズ1の成果をデプロイする

## Phase 2: セットアップウィザード開発 (BASIC.md 4, 6)

- [ ] demo.sheetdb.app/setup でスプレッドシートとストレージを紐付ける
- [ ] 管理者アカウントとマスターキーを初期化する
- [ ] _Users / _Roles / _Files を未存在時に自動生成する
- [ ] Configs/Sessions の D1 レコードを生成・更新できる
- [ ] ファイルストレージ設定（Google Drive/S3互換）の入力/保存を実装する
- [ ] 選択したストレージの接続確認を行う
- [ ] フェーズ2の動作確認を実施する
- [ ] フェーズ2の成果をデプロイする

## Phase 3: 認証実装 (BASIC.md 3, 5.1, 5.3)

- [ ] _Users を起点とした認証フローを実装する
- [ ] パスワードはハッシュ化して保存し、ログ/レスポンスに含めない
- [ ] _Roles の作成/更新/参照フローを実装する
- [ ] _Roles と _Users の紐づけ運用を実装する
- [ ] フェーズ3の動作確認を実施する
- [ ] フェーズ3の成果をデプロイする

## Phase 4: データ登録（作成） (BASIC.md 3, 5, 7.2)

- [ ] シート構造（1行目/2行目/3行目）とメタデータJSONを解釈する
- [ ] 型/必須/ユニーク/デフォルト/バリデーションを適用して作成する
- [ ] ACL判定を適用して作成可否を決定する（public/role/user + master key）
- [ ] 新規シート作成時の既定カラムを自動生成する
- [ ] 作成後にキャッシュ再生成を実行する
- [ ] フェーズ4の動作確認を実施する
- [ ] フェーズ4の成果をデプロイする

## Phase 5: データ更新 (BASIC.md 3, 7.2)

- [ ] ACL判定を適用して更新権限を判定する（public/role/user + master key）
- [ ] 更新時もメタデータに基づくバリデーションを適用する
- [ ] 更新後にキャッシュ再生成を実行する
- [ ] フェーズ5の動作確認を実施する
- [ ] フェーズ5の成果をデプロイする

## Phase 6: データ削除 (BASIC.md 7.2)

- [ ] ACL判定を適用して削除権限を判定する（public/role/user + master key）
- [ ] 削除後にキャッシュ再生成を実行する
- [ ] フェーズ6の動作確認を実施する
- [ ] フェーズ6の成果をデプロイする

## Phase 7: データ取得・キャッシュ (BASIC.md 6.2, 7.1)

- [ ] KV キャッシュを60分（3600秒）で運用する
- [ ] Readフロー（認証→KV→シート→ACL→ページング）を実装する
- [ ] ACL判定を適用して読み取り可否を決定する（public/role/user + master key）
- [ ] キャッシュミス時のシート取得と再キャッシュを行う
- [ ] フェーズ7の動作確認を実施する
- [ ] フェーズ7の成果をデプロイする

## Phase 8: ファイルアップロード/ダウンロード (BASIC.md 2, 5.3)

- [ ] _Files メタ情報の登録/更新フローを実装する
- [ ] Google Drive へのアップロード/ダウンロードを実装する
- [ ] S3互換ストレージへのアップロード/ダウンロードを実装する
- [ ] ACL に従ってファイルアクセスを制御する
- [ ] フェーズ8の動作確認を実施する
- [ ] フェーズ8の成果をデプロイする
